#!/usr/bin/env ruby

require 'bundler/setup'
require 'benchmark/ips'
require 'optparse'
require 'llrb'

preview = false
opt = OptionParser.new
opt.on('-p') { preview = true }
opt.parse!(ARGV)

ruby = Class.new
def ruby.fib(n)
  if n < 3
    1
  else
    fib(n-1) + fib(n-2)
  end
end

llrb = Class.new
def llrb.fib(n)
  if n < 3
    1
  else
    fib(n-1) + fib(n-2)
  end
end
return LLRB::JIT.preview(llrb, :fib) if preview
LLRB::JIT.compile(llrb, :fib)

Benchmark.ips do |x|
  x.report('Ruby') { ruby.fib(34) }
  x.report('LLRB') { llrb.fib(34) }
  x.compare!
end
