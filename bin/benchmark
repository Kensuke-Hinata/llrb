#!/usr/bin/env ruby

require 'bundler/setup'
require 'benchmark/ips'
require 'llrb'

script = File.read(ARGV.first || "#{__dir__}/scripts/bm_app_fib.rb")

ruby = Class.new
ruby.instance_eval("def self.script; #{script.gsub(/LLRB::JIT.compile\([^\)]+\)/, '')}; end")
native = Class.new
native.instance_eval("def self.script; #{script}; end")

Benchmark.ips do |x|
  x.report('ruby')   { ruby.script }
  x.report('native') { native.script }
  x.compare!
end
