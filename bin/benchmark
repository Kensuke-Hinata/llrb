#!/usr/bin/env ruby

require 'bundler/setup'
require 'benchmark/ips'
require 'llruby'

script = File.read(ARGV.first || "#{__dir__}/scripts/arithmetic.rb")

klass = Class.new
klass.instance_eval("def self.ruby; #{script}; end")
klass.instance_eval("def self.native; #{script}; end")
LLRuby::JIT.precompile(klass, :native)

Benchmark.ips do |x|
  x.report('ruby')   { klass.ruby }
  x.report('native') { klass.native }
  x.compare!
end
